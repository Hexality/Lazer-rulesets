@echo off
powershell -noexit -command "if((Test-Path $env:ProgramFiles/Powershell/*/pwsh.exe) -eq $True) { if((pwsh -command '(Get-Variable PSVersionTable -ValueOnly).PSVersion | Select -Expand Major' -ErrorAction SilentlyContinue) -ge '7') { powershell -command 'Set-Location $env:LOCALAPPDATA\Temp ; Invoke-WebRequest https://github.com/gerardog/gsudo/releases/download/v0.7.3/gsudo.v0.7.3.zip -OutFile .\gsudo.zip ; Expand-Archive .\gsudo.zip .\ -Force ; Write-Host -ForegroundColor Blue `'You will be asked for administrator permission, please allow it to continue. After that, it should ask you confirmation, press Y and enter right after. '` ; Start-Sleep -s 5 ; .\gsudo.exe powershell -command `'Set-ExecutionPolicy -Scope CurrentUser RemoteSigned'` ; Write-Host -ForegroundColor Green `'Now you should be able to run the installer, have fun. '` ; Start-Sleep -s 5' }} else { Write-Output `'Unsupported version of powershell detected, updating... '` ; $psVer = Invoke-WebRequest https://github.com/PowerShell/PowerShell/releases/latest/ -Headers @{'Accept'='application/json'} ; $psTag = $psVer.Content | ConvertFrom-Json | Select-Object -expand tag_name ; $psVer = $psTag.Trim(`'v'`) ; $filePS = Test-Path $env:LOCALAPPDATA/Temp/PowerShell-x64.msi ; if($filePS -eq $False) {  Invoke-WebRequest -Uri https://github.com/PowerShell/PowerShell/releases/latest/download/PowerShell-$psVer-win-x64.msi -OutFile $env:LOCALAPPDATA/Temp/PowerShell-x64.msi  } ; Write-Host -ForegroundColor Green `'Please complete the installation manually. '` ; cmd /C msiexec /i %LOCALAPPDATA%\Temp\PowerShell-x64.msi /norestart ; Write-Output `'Setting ExecutionPolicy to RemoteSigned'` ; Set-Location $env:LOCALAPPDATA\Temp ; Invoke-WebRequest https://github.com/gerardog/gsudo/releases/download/v0.7.3/gsudo.v0.7.3.zip -OutFile .\gsudo.zip ; Expand-Archive .\gsudo.zip .\ -Force ; Write-Host -ForegroundColor Blue `'You will be asked for administrator permission, please allow it to continue. After that, it should ask you confirmation, press Y and enter right after. '` ; Start-Sleep -s 5 ; .\gsudo.exe powershell -command `'Set-ExecutionPolicy -Scope CurrentUser RemoteSigned'` ; Write-Host -ForegroundColor Green `'Now you should be able to run the installer, have fun.'` ; Start-Sleep -s 5'}" 